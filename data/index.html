<!DOCTYPE html>
<html>
  <head>
    <title>AuTomato</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
  </head>
  <body>
    <h1>Pomodoro em andamento...</h1>
    <p id="status">Status: Aguardando início...</p>

    <form onsubmit="enviarConfiguracao(); return false;">
      <label>Tempo de trabalho (min): <input type="number" id="foco" value="25"></label><br>
      <label>Tempo de pausa (min): <input type="number" id="pausa" value="5"></label><br>
      <button type="submit">Atualizar Ciclos</button>
    </form>

    <!-- FORMULÁRIO DE INCIO -->
    <div id="pergunta" style="font-weight:bold; margin-bottom:10px;"></div>
   <form id="pre-form" onsubmit="enviarRespostaPre(event); return false;" autocomplete="off" novalidate style="display: none;">
      <table>
        <thead>
          <tr>
            <th></th>
            <th>Nenhum</th>
            <th>Bem pouco</th>
            <th>Mais ou menos</th>
            <th>Em grande medida</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Quão cansado(a) você se sente agora?</td>
            <td><input name="fatigue" required type="radio" value="1" aria-label="Nenhum cansaço"/></td>
            <td><input name="fatigue" type="radio" value="2" aria-label="Bem pouco cansaço"/></td>
            <td><input name="fatigue" type="radio" value="3" aria-label="Mais ou menos cansado"/></td>
            <td><input name="fatigue" type="radio" value="4" aria-label="Muito cansado"/></td>
          </tr>
          <tr>
            <td>Quão motivado(a) você se sente agora?</td>
            <td><input name="motivation" required type="radio" value="1" aria-label="Nenhuma motivação"/></td>
            <td><input name="motivation" type="radio" value="2" aria-label="Bem pouca motivação"/></td>
            <td><input name="motivation" type="radio" value="3" aria-label="Mais ou menos motivado"/></td>
            <td><input name="motivation" type="radio" value="4" aria-label="Muito motivado"/></td>
          </tr>
          <tr>
            <td>Quão produtivo(a) você se sente agora?</td>
            <td><input name="productivity" required type="radio" value="1" aria-label="Nada produtivo"/></td>
            <td><input name="productivity" type="radio" value="2" aria-label="Bem pouco produtivo"/></td>
            <td><input name="productivity" type="radio" value="3" aria-label="Mais ou menos produtivo"/></td>
            <td><input name="productivity" type="radio" value="4" aria-label="Muito produtivo"/></td>
          </tr>
        </tbody>
      </table>
      <button type="submit" onclick="enviarResposta()">Enviar novo</button>
    </form>
    <!-- FORMULÁRIO FINAL -->
     <form id="pos-form" style="display: none;" autocomplete="off" novalidate  onsubmit="enviarRespostaPos(event); return false;">
      <label for="focoFinal">Como está seu foco agora?</label>
      <input
        id="focoFinal"
        name="focoFinal"
        required
        type="text"
        autocomplete="off"
        aria-label="Como está seu foco agora?"
      />
      <br>

      <label for="comentarios">Comentários</label>
      <textarea
        id="comentarios"
        name="comentarios"
        autocomplete="off"
        aria-label="Comentários"
      ></textarea>

      <h2>Avalie o progresso das tarefas realizadas</h2>
      <div class="tasks">
        <label for="task1">Tarefas: <span id="val1">0</span>%</label>
        <input id="task1" name="task1" type="range" min="0" max="100" value="0" oninput="val1.innerText = this.value" aria-label="Progresso da Tarefa 1"/>
      </div>
      <button type="submit" onclick="enviarResposta()">Enviar Dados</button>
    </form>

<script>
  function enviarConfiguracao() {
    const foco = document.getElementById("foco").value;
    const pausa = document.getElementById("pausa").value;
    fetch("/config", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `foco=${foco}&pausa=${pausa}`
    }).then(res => {
      if (res.ok) alert("Ciclos atualizados!");
    });
  }

  function enviarRespostaPre(event) {
    event.preventDefault();
    const fatigue = document.querySelector('input[name="fatigue"]:checked');
    const motivation = document.querySelector('input[name="motivation"]:checked');
    const productivity = document.querySelector('input[name="productivity"]:checked');

    if (!fatigue || !motivation || !productivity) {
      alert("Por favor, responda todas as perguntas.");
      return;
    }

    const body = `fatigue=${fatigue.value}&motivation=${motivation.value}&productivity=${productivity.value}`;

    fetch("/resposta", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: body
    }).then(res => {
      if (res.ok) {
        document.getElementById("pre-form").style.display = "none";
        alert("Resposta enviada!");
      }
    });
  }

  function enviarRespostaPos(event) {
    event.preventDefault();
    const focoFinal = document.getElementById("focoFinal").value;
    const comentarios = document.getElementById("comentarios").value;

    const progresso = `task1=${document.getElementById("task1").value}`;

    const body = `focoFinal=${encodeURIComponent(focoFinal)}&comentarios=${encodeURIComponent(comentarios)}&${progresso}`;

    fetch("/resposta", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: body
    }).then(res => {
      if (res.ok) {
        document.getElementById("pos-form").style.display = "none";
        alert("Resposta final enviada!");
      }
    });
  }

  setInterval(() => {
    fetch("/status")
      .then(response => response.json())
      .then(data => {
        if (data.pergunta === "Pré Formulario") {
          document.getElementById("pre-form").style.display = "block";
          document.getElementById("pos-form").style.display = "none";
          document.getElementById("pergunta").innerText = "Antes de iniciar:";
        } else if (data.pergunta === "Pós Formulario") {
          document.getElementById("pre-form").style.display = "none";
          document.getElementById("pos-form").style.display = "block";
          document.getElementById("pergunta").innerText = "Após finalização:";
        } else {
          document.getElementById("pre-form").style.display = "none";
          document.getElementById("pos-form").style.display = "none";
          document.getElementById("pergunta").innerText = "";
        }
      });
  }, 2000);
</script>

  </body>
</html>