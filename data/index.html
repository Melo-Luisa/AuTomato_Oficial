<!DOCTYPE html>
<html>
  <head>
    <title>AuTomato</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Pomodoro em andamento...</h1>
    <p id="status">Status: Aguardando in√≠cio...</p>

    <form onsubmit="enviarConfiguracao(); return false;">
      <label>Tempo de trabalho (min): <input type="number" id="foco" value="25"></label><br>
      <label>Tempo de pausa (min): <input type="number" id="pausa" value="5"></label><br>
      <button type="submit">Atualizar Ciclos</button>
    </form>

    <div id="pesquisa" style="display:none;">
      <p id="pergunta"></p>
      <input type="text" id="resposta">
      <button onclick="enviarResposta()">Enviar</button>
    </div>

    <script>
      function enviarConfiguracao() {
        const foco = document.getElementById("foco").value;
        const pausa = document.getElementById("pausa").value;
        // Converter minutos para segundos
        const focoSeg = foco;
        const pausaSeg = pausa ;
        fetch("/config", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `foco=${focoSeg}&pausa=${pausaSeg}`
        }).then(res => {
          if (res.ok) alert("Ciclos atualizados!");
        });
      }

      function exibirPergunta(pergunta) {
        document.getElementById("pergunta").innerText = pergunta;
        document.getElementById("pesquisa").style.display = "block";
      }

      function enviarResposta() {
        const resp = document.getElementById("resposta").value;
        fetch("/resposta", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `resposta=${resp}`
        }).then(res => {
          if (res.ok) {
            document.getElementById("pesquisa").style.display = "none";
          }
        });
      }

      setInterval(() => {
        fetch("/status")
          .then(res => res.json())
          .then(data => {
            document.getElementById("status").innerHTML = data.emTrabalho ? "Status: Trabalho" : "Status: Pausa";
            if (data.pergunta) {
              exibirPergunta(data.pergunta);
            }
          });
      }, 2000);
    </script>
  </body>
</html>