<!DOCTYPE html>
<html>
  <head>
    <title>AuTomato</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <h1>Pomodoro em andamento...</h1>
    <p id="status">Status: Aguardando início...</p>

    <form onsubmit="enviarConfiguracao(); return false;">
      <label>Tempo de trabalho (min): <input type="number" id="foco" value="25"></label><br>
      <label>Tempo de pausa (min): <input type="number" id="pausa" value="5"></label><br>
      <button type="submit">Atualizar Ciclos</button>
    </form>

    
    <div id="pergunta" style="font-weight:bold; margin-bottom:10px;">oiiii</div>
    <form id="pre-form" style="display:block;" autocomplete="off" novalidate>
      <table>
        <thead>
          <tr>
            <th></th>
            <th>Nenhum</th>
            <th>Bem pouco</th>
            <th>Mais ou menos</th>
            <th>Em grande medida</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Quão cansado(a) você se sente agora?</td>
            <td><input name="fatigue" required type="radio" value="1" aria-label="Nenhum cansaço"/></td>
            <td><input name="fatigue" type="radio" value="2" aria-label="Bem pouco cansaço"/></td>
            <td><input name="fatigue" type="radio" value="3" aria-label="Mais ou menos cansado"/></td>
            <td><input name="fatigue" type="radio" value="4" aria-label="Muito cansado"/></td>
          </tr>
          <tr>
            <td>Quão motivado(a) você se sente agora?</td>
            <td><input name="motivation" required type="radio" value="1" aria-label="Nenhuma motivação"/></td>
            <td><input name="motivation" type="radio" value="2" aria-label="Bem pouca motivação"/></td>
            <td><input name="motivation" type="radio" value="3" aria-label="Mais ou menos motivado"/></td>
            <td><input name="motivation" type="radio" value="4" aria-label="Muito motivado"/></td>
          </tr>
          <tr>
            <td>Quão produtivo(a) você se sente agora?</td>
            <td><input name="productivity" required type="radio" value="1" aria-label="Nada produtivo"/></td>
            <td><input name="productivity" type="radio" value="2" aria-label="Bem pouco produtivo"/></td>
            <td><input name="productivity" type="radio" value="3" aria-label="Mais ou menos produtivo"/></td>
            <td><input name="productivity" type="radio" value="4" aria-label="Muito produtivo"/></td>
          </tr>
        </tbody>
      </table>
      <button type="submit" onclick="enviarResposta()">Enviar novo</button>
    </form>

    <script>
      function enviarConfiguracao() {
        const foco = document.getElementById("foco").value;
        const pausa = document.getElementById("pausa").value;
        // Converter minutos para segundos
        const focoSeg = foco;
        const pausaSeg = pausa ;
        fetch("/config", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `foco=${focoSeg}&pausa=${pausaSeg}`
        }).then(res => {
          if (res.ok) alert("Ciclos atualizados!");
        });
      }

      function exibirPergunta(pergunta) {
        if (pergunta == "formulario") {
          document.getElementById("pre-form").style.display = "block";
        } else {
          document.getElementById("pre-form").style.display = "none";
        }
        // document.getElementById("pergunta").innerText = pergunta !== "formulario" ? pergunta : "";
      }

      function enviarResposta() {
        // Coleta os valores selecionados dos radios do pre-form
        const fatigue = document.querySelector('input[name="fatigue"]:checked');
        const motivation = document.querySelector('input[name="motivation"]:checked');
        const productivity = document.querySelector('input[name="productivity"]:checked');

        // Validação simples
        if (!fatigue || !motivation || !productivity) {
          alert("Por favor, responda todas as perguntas.");
          return;
        }

        // Monta o corpo da requisição
        const body = `fatigue=${fatigue.value}&motivation=${motivation.value}&productivity=${productivity.value}`;

        fetch("/resposta", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: body
        }).then(res => {
          if (res.ok) {
            document.getElementById("pre-form").style.display = "none";
            alert("Resposta enviada!");
          }
        });
      }

      setInterval(() => {
        fetch("/status")
          .then(res => res.json())
          .then(data => {
            document.getElementById("status").innerHTML = data.emTrabalho ? "Status: Trabalho" : "Status: Pausa";
            if (data.pergunta) {
              exibirPergunta(data.pergunta);
            }
          });
      }, 2000);
    </script>
  </body>
</html>